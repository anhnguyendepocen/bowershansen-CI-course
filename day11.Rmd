---
title: Instruments, Randomization Assessment (Balance), Adjustment for Interpretable Comparisons
date: '`r format(Sys.Date(), "%B %d, %Y")`'
bibliography: main.bib
fontsize: 10pt
geometry: margin=1in
graphics: yes
biblio-style: authoryear-comp
output:
  beamer_presentation:
    slide_level: 2
    keep_tex: true
    latex_engine: xelatex
    citation_package: biblatex
    includes:
        in_header:
           - defs-all.sty
---


<!-- Make this document using library(rmarkdown); render("exploration1.Rmd") -->
<!--- \input{defs-all} --->


```{r include=FALSE, cache=FALSE}
# Some customization.  You can alter or delete as desired (if you know what you are doing).
# knitr settings to control how R chunks work.

## To make the html file do
## render("exploration1.Rmd",output_format=html_document(fig_retina=FALSE))
## To make the pdf file do
## render("exploration1.Rmd",output_format=pdf_document())

require(knitr)
opts_chunk$set(
  tidy=FALSE,     # display code as typed
  echo=TRUE,
  results='markup',
  strip.white=TRUE,
  fig.path='figs/fig',
  cache=FALSE,
  highlight=TRUE,
  width.cutoff=132,
  size='footnotesize',
  out.width='.9\\textwidth',
  fig.retina=FALSE,
  message=FALSE,
  comment=NA)

if(!file.exists('figs')) dir.create('figs')

options(SweaveHooks=list(fig=function(){
			   par(mar=c(3.5, 3, 1.1, 0),
			       pty="s",
			       mgp=c(1.5,0.5,0),
			       oma=c(0,0,0,0))},
			 echo=function(){options(continue=" ") ##Don't show "+" prompts,
			 options(prompt=" ")
			 }),
	digits=4,
	scipen=8,
	width=132
	)
```

## Today

\begin{enumerate}
  \item Agenda: Introductions; Where are we going?; Weak Instruments (Imbens and Rosenbaum 2005); Randomization
    assessment (Were the covariates balanced? Standards for balance?); Methods
    of adjustment / making the case for interpretability of comparisons /
    ignorability for observational studies.
\item Reading for tomorrow: DOS 8--9, 13.
\item Blalock Lecture tonight on academic publishing -- from editors of
  journals!
\item Questions arising from assignment 2: Benefits of gain scores?; 2SLS
  Intuition?; "Figure 2 sided..." is "Produce 2 sided..."
\end{enumerate}

<!-- \input{announcement-of-the-day.tex} -->

# Strategies for randomized studies

## Make the case that randomization worked.
## Increase precision with design and test statistics (and even models of effects)
## Make sure that your estimator is estimating the right thing (i.e. is not biased or at least is consistent)

# Strategies for Adjustment of Observational Studies

## If you have randomized $Z$ but not $D$, then IV. (Not really an observational study.)
## "Controlling For"
## Matched Stratification
## Find a discontinuity/A Natural Experiment



# The precision benefits of a baseline outcome in an experiment

## See Example from the Newspapers Experiment

I expect that the reference distribution for $H_0: y_{iT}=y_{iC}$ will be
narrower with (1) the gain score and (2) using pair-randomized treatment
assignment.

```{r loaddata}
## newsdf<-read.csv("http://jakebowers.org/Data/news.df.csv")
newsdf<-read.csv("data/news.df.csv")
```


## Define functions

```{r results="hide",tidy=TRUE, size='tiny'}
meanDiffTZ <- function(y,z){
    mndiff <- mean(y[z==1]) - mean(y[z==0])
    return(mndiff)
}

pairMeanDiffTZ <- function(y,z,b){
  z <- z[order(b)]
  y <- y[order(b)]
  ydiff <- y[z==1] - y[z==0]
  mean(ydiff)
}

library(randomizr)
newExperimentPair <- function(b){
    block_ra(block_var=b)
}

library(permute)
newExperimentPair2 <- function(z,b){
  how1 <- how(blocks=b)
  z[shuffle(length(z),control=how1)]
}

## could also have used complete_ra() from randomizr or shuffle() from permute
newExperiment <- function(z){
    sample(z)
}
```

## The reference dists

```{r cache=TRUE}
set.seed(12345)
res1 <- replicate(1000,meanDiffTZ(y=newsdf$r,z=newExperiment(newsdf$z)))
res2 <- replicate(1000,meanDiffTZ(y=newsdf$r - newsdf$rpre,z=newExperiment(newsdf$z)))
res3 <- replicate(1000,pairMeanDiffTZ(y=newsdf$r,z=newExperimentPair(newsdf$s),b=newsdf$s))
res4 <- replicate(1000,pairMeanDiffTZ(y=newsdf$r - newsdf$rpre,z=newExperimentPair(newsdf$s),b=newsdf$s))
res5 <- replicate(1000,pairMeanDiffTZ(y=newsdf$r,z=newExperimentPair2(newsdf$z,newsdf$s),b=newsdf$s))
res6 <- replicate(1000,pairMeanDiffTZ(y=newsdf$r - newsdf$rpre,z=newExperimentPair2(newsdf$z,newsdf$s),b=newsdf$s))
```

## The reference dists

```{r}
summary(res1)
summary(res2)
summary(res3)
summary(res4)
```

# Weak Instruments and 2SLS

## See Imbens and Rosenbaum 2005 Table

*Example:* Effect of education on wages ( Angrist and Krueger 1991)
*Design:* Instrument/Treatment is quarter of birth, Actual Treatment/Dose is additional year of
education, Outcome is wages

What is the intuition about how 2SLS focuses attention on the effect of
education **only related to quarter of birth**? [ Z $\rightarrow$ D
$\rightarrow$ Y]

# Balance in controlled and natural experiments

\begin{frame}
\frametitle{The Neyman-Rubin Model for (simple) experiments}
\vfill
This is what randomization ensures:
$$ (\alert<4>{Y_t, Y_c},\alert<2>{X}) \perp \alert<3>{Z} $$
\vfill

I.e., each of $X$, $Y_{c}$ and $Y_{t}$ is balanced (in expectation; modulo sampling variability).

\begin{itemize}
\item In controlled experiments, random assignment warrants this.
\item In natural experiments, justified otherwise, or an article of faith.
\item In an experiment, the $x$es aren't necessary for inference.
\item However, the part with the $x$es has testable consequences.
\end{itemize}

\end{frame}

 \begin{frame}%<1>[label=covbalexptsFr]
 \frametitle{Covariate balance in experiments}
 %\only<2>{\framesubtitle{The importance of comparing it to balance in other experiments}}

\begin{columns}
\begin{column}{.4\linewidth}
\begin{itemize}
\item<1-> \cite{arceneaux:2005}
\item<1-> Kansas City, November 2003
\item<1-> Completely randomized design: 14 precincts $\rightarrow$ Tx; 14 $\rightarrow $ Control.

    \item<1-> Substantively large baseline differences
    \item<2-> Differences not large compared to other assignments from same design.
    \item<2-> $\PP(\chi^{2} > x) = .94$ \cite{hansenbowers2008}.
    \end{itemize}
    \end{column}

\begin{column}{.6\linewidth}
\only<1>{\igrphx{KC-baseline}}
\only<2>{\igrphx{KC-bal+SDs}}
\end{column}
\end{columns}

\end{frame}



# Anything Else?

## References
